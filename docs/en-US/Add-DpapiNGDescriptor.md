---
external help file: SecretManagement.DpapiNG.Module.dll-Help.xml
Module Name: SecretManagement.DpapiNG
online version: https://www.github.com/jborean93/SecretManagement.DpapiNG/blob/main/docs/en-US/Add-DpapiNGDescriptor.md
schema: 2.0.0
---

# Add-DpapiNGDescriptor

## SYNOPSIS
Adds a new protection descriptor clause.

## SYNTAX

### Local (Default)
```
Add-DpapiNGDescriptor -InputObject <ProtectionDescriptor> -Local <String> [-Or] [<CommonParameters>]
```

### Sid
```
Add-DpapiNGDescriptor -InputObject <ProtectionDescriptor> -Sid <StringOrAccount> [-Or] [<CommonParameters>]
```

### SidCurrent
```
Add-DpapiNGDescriptor -InputObject <ProtectionDescriptor> [-CurrentSid] [-Or] [<CommonParameters>]
```

## DESCRIPTION
Adds a new protection descriptor clause to an existing protection descriptor created by [New-DpapiNGDescriptor](./New-DpapiNGDescriptor.md).
Each new clause will be added with an `AND` unless `-Or` is specified.
The protection descriptor is used to descibe what entities are allowed to decrypt the secret it protects.
The following descriptor types are supported:

+ `LOCAL`

+ `SID`

The `LOCAL` type can be scoped to just the current user locally or to the local machine.
The `SID` type can be scoped to a user or group SecurityIdentifier.
This protection is applied across the domain allowing a user with this SID to be able to decrypt the secret on any machine.

## EXAMPLES

### Example 1 - Adds the Local user clause
```powershell
PS C:\> $desc = New-DpapiNGDescriptor | Add-DpapiNGDescriptor -Local User
PS C:\> Set-Secret -Vault MyVault -Name MySecret -Secret foo @desc
```

Creates a new protection descriptor for `LOCAL=user` which will protect the secret for the current user.
The descriptor is then used with `Set-Secret` to define how to protect the secret stored in the vault.
It is important to use the descriptor output using the splat syntax when provided ith `Set-Secret`.

### Example 2 - Adds the SID specified
```powershell
PS C:\> $desc = New-DpapiNGDescriptor | Add-DpapiNGDescriptor -CurrentSid
PS C:\> ConvertTo-DpapiNGSecret secret -ProtectionDescriptor $desc
```

Creates a DPAPI-NG secret that is protected by the current user.
This secret can be decrypted on any host in the domain running under the same user.

### Example 3 - Adds multiple SIDs
```powershell
PS C:\> $domainAdmins = [System.Security.Principal.NTAccount]'DOMAIN\Domain Admins'
PS C:\> $desc = New-DpapiNGDescriptor |
    Add-DpapiNGDescriptor -CurrentSid |
    Add-DpapiNGDescriptor -Sid $domainAdmins
PS C:\> ConvertTo-DpapiNGSecret secret -ProtectionDescriptor $desc
```

Creates a DPAPI-NG secret that is protected by the current user when a `Domain Admins` member.

## PARAMETERS

### -CurrentSid
Adds the clause `SID=$UserSid` where `$UserSid` represents the current user's SecurityIdentifier.
A secret protected by this value can be decrypted by this user on any machine in the domain.

```yaml
Type: SwitchParameter
Parameter Sets: SidCurrent
Aliases:

Required: True
Position: Named
Default value: None
Accept pipeline input: False
Accept wildcard characters: False
```

### -InputObject
The protection descriptor object generated by [New-DpapiNGDescriptor](./New-DpapiNGDescriptor.md).

```yaml
Type: ProtectionDescriptor
Parameter Sets: (All)
Aliases:

Required: True
Position: Named
Default value: None
Accept pipeline input: True (ByValue)
Accept wildcard characters: False
```

### -Local
Adds the `LOCAL` descriptor clause to either `User` or `Machine`.
The `User` value protects the secret to just this user on the current host.
The `Machine` value protects the secret to the current computer.

```yaml
Type: String
Parameter Sets: Local
Aliases:
Accepted values: User, Machine

Required: True
Position: Named
Default value: None
Accept pipeline input: False
Accept wildcard characters: False
```

### -Or
Adds the new descriptor clause with an `OR` rather than an `AND`.
How this is treated by DPAPI-NG depends on the existing clauses that have already been added.

```yaml
Type: SwitchParameter
Parameter Sets: (All)
Aliases:

Required: False
Position: Named
Default value: None
Accept pipeline input: False
Accept wildcard characters: False
```

### -Sid
Adds the `SID` descriptor clause to the SecurityIdentifier specified.
The SecurityIdentifier can be the SID of a domain user or group.
If a group SID is specified, any user who is a member of that group can decrypt the secret it applies to.

```yaml
Type: StringOrAccount
Parameter Sets: Sid
Aliases:

Required: True
Position: Named
Default value: None
Accept pipeline input: False
Accept wildcard characters: False
```

### CommonParameters
This cmdlet supports the common parameters: -Debug, -ErrorAction, -ErrorVariable, -InformationAction, -InformationVariable, -OutVariable, -OutBuffer, -PipelineVariable, -Verbose, -WarningAction, and -WarningVariable. For more information, see [about_CommonParameters](http://go.microsoft.com/fwlink/?LinkID=113216).

## INPUTS

### ProtectionDescriptor
The ProtectionDescriptor object created by New-DpapiNGDescriptor (./New-DpapiNGDescriptor.md).

## OUTPUTS

### ProtectionDescriptor
The modified ProtectionDescriptor object with the new clause.

## NOTES

## RELATED LINKS

[DPAPI NG Protection Descriptors](https://learn.microsoft.com/en-us/windows/win32/seccng/protection-descriptors)
